<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Bot Dashboard</title>
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>
<body>
    <div class="container">
        <!-- Header -->
        <header class="header">
            <h1>🤖 Trading Bot Dashboard</h1>
            <div class="status-indicator">
                <span id="status-dot" class="dot"></span>
                <span id="status-text">Conectando...</span>
            </div>
        </header>

        <!-- Account Info -->
        <section class="card">
            <h2>💼 Estado de la Cuenta</h2>
            <div class="stats-grid">
                <div class="stat-card">
                    <div class="stat-label">Balance</div>
                    <div class="stat-value" id="balance">€0.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Disponible</div>
                    <div class="stat-value" id="available">€0.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">Margen Usado</div>
                    <div class="stat-value" id="margin-used">€0.00</div>
                </div>
                <div class="stat-card">
                    <div class="stat-label">% Margen</div>
                    <div class="stat-value" id="margin-percent">0%</div>
                </div>
            </div>
        </section>

        <!-- Positions -->
        <section class="card">
            <h2>📊 Posiciones Abiertas (<span id="positions-count">0</span>)</h2>
            <div id="positions-container">
                <p class="loading">Cargando posiciones...</p>
            </div>
        </section>

        <!-- NEW: Trading History -->
        <section class="card">
            <div class="card-header">
                <h2>📈 Historial de Trades</h2>
                <div class="button-group">
                    <button class="btn btn-primary" onclick="exportTradesCSV()">
                        📄 Exportar CSV
                    </button>
                    <button class="btn btn-primary" onclick="exportTradesExcel()">
                        📊 Exportar Excel
                    </button>
                    <button class="btn btn-success" onclick="generateReport()">
                        📑 Reporte Completo
                    </button>
                </div>
            </div>
            
            <div class="filters">
                <label>
                    Sesión:
                    <select id="session-filter" onchange="loadTrades()">
                        <option value="">Todas las sesiones</option>
                    </select>
                </label>
                <label>
                    Límite:
                    <select id="limit-filter" onchange="loadTrades()">
                        <option value="20">20</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                        <option value="200">200</option>
                    </select>
                </label>
                <button class="btn btn-secondary" onclick="loadTrades()">🔄 Actualizar</button>
            </div>
            
            <div id="trades-container">
                <p class="loading">Cargando trades...</p>
            </div>
        </section>

        <!-- NEW: Trading Statistics -->
        <section class="card">
            <h2>📊 Estadísticas</h2>
            <div id="stats-container">
                <p class="loading">Cargando estadísticas...</p>
            </div>
        </section>

        <!-- NEW: Backtesting -->
        <section class="card">
            <div class="card-header">
                <h2>🔬 Backtesting</h2>
            </div>
            
            <div class="backtest-form">
                <div class="form-row">
                    <label>
                        Días históricos:
                        <input type="number" id="backtest-days" value="30" min="1" max="365">
                    </label>
                    <label>
                        Capital inicial:
                        <input type="number" id="backtest-capital" value="10000" min="100" step="100">
                    </label>
                </div>
                <button class="btn btn-warning" onclick="runBacktest()">
                    ▶️ Ejecutar Backtest
                </button>
            </div>
            
            <div id="backtest-results" style="display: none;">
                <h3>Resultados del Backtest</h3>
                <div class="stats-grid" id="backtest-stats"></div>
                <div id="backtest-trades-list"></div>
            </div>
        </section>

        <!-- NEW: Recent Signals -->
        <section class="card">
            <div class="card-header">
                <h2>🎯 Señales Recientes</h2>
                <button class="btn btn-secondary" onclick="loadSignals()">🔄 Actualizar</button>
            </div>
            <div id="signals-container">
                <p class="loading">Cargando señales...</p>
            </div>
        </section>

        <!-- Configuration -->
        <section class="card">
            <h2>⚙️ Configuración</h2>
            <div class="config-grid" id="config-container">
                <p class="loading">Cargando configuración...</p>
            </div>
        </section>

        <!-- Footer -->
        <footer>
            <p>Última actualización: <span id="last-update">--:--:--</span></p>
            <p>Auto-refresh cada 10 segundos</p>
        </footer>
    </div>

    <!-- Loading Overlay -->
    <div id="loading-overlay" style="display: none;">
        <div class="spinner"></div>
        <p>Procesando...</p>
    </div>

    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>