# ğŸŒ Trading Bot Dashboard - GuÃ­a Completa

Dashboard web completo para monitorear y controlar el trading bot con funcionalidades de exportaciÃ³n, backtesting y anÃ¡lisis.

---

## ğŸ“‹ Contenidos

1. [CaracterÃ­sticas](#caracterÃ­sticas)
2. [InstalaciÃ³n](#instalaciÃ³n)
3. [Uso](#uso)
4. [Endpoints API](#endpoints-api)
5. [Funcionalidades](#funcionalidades)
6. [Testing](#testing)
7. [Troubleshooting](#troubleshooting)

---

## âœ¨ CaracterÃ­sticas

### **Monitoreo en Tiempo Real**
- ğŸ’¼ Estado de la cuenta (balance, disponible, margen)
- ğŸ“Š Posiciones abiertas con detalles
- ğŸ¯ SeÃ±ales de trading recientes
- âš™ï¸ ConfiguraciÃ³n del bot

### **Historial y AnÃ¡lisis**
- ğŸ“ˆ Historial completo de trades
- ğŸ“Š EstadÃ­sticas detalladas (win rate, P&L, etc.)
- ğŸ” Filtros por sesiÃ³n y fecha
- ğŸ“‰ AnÃ¡lisis de performance

### **ExportaciÃ³n de Datos**
- ğŸ“„ Exportar trades a CSV
- ğŸ“Š Exportar trades a Excel
- ğŸ“‘ Generar reportes completos multi-hoja

### **Backtesting**
- ğŸ”¬ Ejecutar backtests con datos histÃ³ricos
- ğŸ“ˆ Visualizar resultados
- ğŸ“Š MÃ©tricas de performance

### **GestiÃ³n de Sesiones**
- ğŸ“… Ver todas las sesiones de trading
- ğŸ” Detalle completo por sesiÃ³n
- ğŸ“Š Comparar performance entre sesiones

---

## ğŸš€ InstalaciÃ³n

### 1. Prerrequisitos

```bash
# Python 3.9+
python --version

# PostgreSQL (Docker)
docker-compose up -d postgres

# Verificar que PostgreSQL estÃ¡ corriendo
docker ps | grep postgres
```

### 2. Instalar Dependencias

```bash
# Instalar todas las dependencias
pip install -r requirements.txt

# Verificar instalaciÃ³n
python -c "import flask; import psycopg2; import pytest; print('âœ… Todo instalado')"
```

### 3. Configurar Variables de Entorno

```bash
# Copiar template
cp .env.example .env

# Editar con tus credenciales
nano .env
```

Ejemplo de `.env`:
```env
# API Credentials
CAPITAL_API_KEY=tu_api_key
CAPITAL_EMAIL=tu_email@ejemplo.com
CAPITAL_PASSWORD=tu_password

# Database
DB_HOST=localhost
DB_PORT=5432
DB_NAME=trading_bot
DB_USER=trader
DB_PASSWORD=trader_password

# Dashboard
DASHBOARD_PORT=5000
```

### 4. Aplicar Migraciones

```bash
# Ejecutar migraciones de BD
python database/migrations/migration_runner.py migrate

# Verificar tablas
python database/migrations/migration_runner.py status
```

### 5. Setup AutomÃ¡tico

```bash
# Ejecutar script de setup (verifica todo)
python setup_dashboard.py
```

---

## â–¶ï¸ Uso

### Iniciar el Dashboard

#### **OpciÃ³n 1: Dashboard Solo**

```bash
# Iniciar solo el dashboard
python dashboard/app.py

# El dashboard estarÃ¡ disponible en:
# http://localhost:5000
```

#### **OpciÃ³n 2: Bot + Dashboard**

```bash
# Iniciar bot y dashboard juntos
python start_all.py

# Dashboard: http://localhost:5000
# Bot ejecutÃ¡ndose en background
```

### Acceder al Dashboard

1. Abre tu navegador
2. Ve a: `http://localhost:5000`
3. El dashboard se actualiza automÃ¡ticamente cada 10 segundos

---

## ğŸŒ Endpoints API

### **Endpoints BÃ¡sicos**

| Endpoint | MÃ©todo | DescripciÃ³n |
|----------|--------|-------------|
| `/` | GET | PÃ¡gina principal del dashboard |
| `/api/account` | GET | InformaciÃ³n de la cuenta |
| `/api/positions` | GET | Posiciones abiertas |
| `/api/config` | GET | ConfiguraciÃ³n del bot |
| `/api/status` | GET | Estado del bot |
| `/api/health` | GET | Health check |

### **Endpoints de Trades**

| Endpoint | MÃ©todo | DescripciÃ³n |
|----------|--------|-------------|
| `/api/trades/history` | GET | Historial de trades |
| `/api/trades/history?session_id=X` | GET | Trades de una sesiÃ³n |
| `/api/trades/history?limit=100` | GET | Ãšltimos N trades |
| `/api/trades/stats` | GET | EstadÃ­sticas globales |
| `/api/trades/stats?session_id=X` | GET | Stats de una sesiÃ³n |

### **Endpoints de Export**

| Endpoint | MÃ©todo | DescripciÃ³n |
|----------|--------|-------------|
| `/api/trades/export/csv` | GET | Exportar a CSV |
| `/api/trades/export/excel` | GET | Exportar a Excel |
| `/api/trades/export/csv?session_id=X` | GET | Export sesiÃ³n especÃ­fica |
| `/api/report/full?session_id=X` | GET | Reporte completo multi-hoja |

### **Endpoints de Sesiones**

| Endpoint | MÃ©todo | DescripciÃ³n |
|----------|--------|-------------|
| `/api/sessions/list` | GET | Listar sesiones |
| `/api/sessions/list?limit=20` | GET | Ãšltimas N sesiones |
| `/api/sessions/<id>` | GET | Detalle de sesiÃ³n |

### **Endpoints de Backtesting**

| Endpoint | MÃ©todo | DescripciÃ³n |
|----------|--------|-------------|
| `/api/backtest/run` | POST | Ejecutar backtest |

Body del POST:
```json
{
    "days": 30,
    "initial_capital": 10000,
    "assets": ["GOLD", "TSLA"]
}
```

### **Endpoints de SeÃ±ales**

| Endpoint | MÃ©todo | DescripciÃ³n |
|----------|--------|-------------|
| `/api/signals/recent` | GET | SeÃ±ales recientes |
| `/api/signals/recent?limit=20` | GET | Ãšltimas N seÃ±ales |

---

## ğŸ¯ Funcionalidades

### **1. Monitoreo de Cuenta**

```
ğŸ’¼ Estado de la Cuenta
â”œâ”€â”€ Balance:        â‚¬10,000.00
â”œâ”€â”€ Disponible:     â‚¬8,000.00
â”œâ”€â”€ Margen Usado:   â‚¬2,000.00
â””â”€â”€ % Margen:       20.0%
```

**ActualizaciÃ³n:** AutomÃ¡tica cada 10 segundos

### **2. Posiciones Abiertas**

Ver todas las posiciones activas con:
- Epic (activo)
- DirecciÃ³n (BUY/SELL)
- TamaÃ±o
- Precio de entrada
- Stop Loss
- Take Profit
- Deal ID

### **3. Historial de Trades**

**Filtros disponibles:**
- Por sesiÃ³n
- LÃ­mite de resultados (20, 50, 100, 200)

**InformaciÃ³n mostrada:**
- Epic
- DirecciÃ³n
- Entry/Exit prices
- Size
- P&L (â‚¬ y %)
- RazÃ³n de cierre
- Fecha

### **4. ExportaciÃ³n de Trades**

#### **CSV**
```
Epic, Direction, Entry Price, Exit Price, Size, PnL, PnL %, Reason, Date
GOLD, BUY, 1800.00, 1850.00, 1.0, 50.00, 2.78, TAKE_PROFIT, 2025-01-06 10:30
...
```

#### **Excel**
Exporta con formato profesional:
- Headers en negrita
- NÃºmeros formateados
- Colores por P&L (verde/rojo)

#### **Reporte Completo**
MÃºltiples hojas:
1. **Resumen**: Info de la sesiÃ³n
2. **Trades**: Todos los trades
3. **EstadÃ­sticas**: MÃ©tricas agregadas
4. **SeÃ±ales**: SeÃ±ales generadas

### **5. EstadÃ­sticas**

MÃ©tricas calculadas automÃ¡ticamente:
- Total de trades
- Trades ganadores/perdedores
- Win rate (%)
- Ganancia promedio
- PÃ©rdida promedio
- Mayor ganancia
- Mayor pÃ©rdida
- Profit factor
- Max drawdown

### **6. Backtesting**

**ConfiguraciÃ³n:**
- DÃ­as histÃ³ricos (1-365)
- Capital inicial (min â‚¬100)
- Activos (opcional)

**Resultados:**
- Capital inicial/final
- Retorno total (â‚¬ y %)
- Total de trades
- Win rate
- Profit factor
- Max drawdown
- Equity curve
- Lista de trades

### **7. SeÃ±ales de Trading**

Ver las Ãºltimas seÃ±ales generadas:
- Epic
- Tipo (BUY/SELL/NEUTRAL)
- Confianza (%)
- Precio actual
- Indicadores
- Razones
- Estado (Ejecutada/Pendiente)

---

## ğŸ§ª Testing

### Ejecutar Tests

```bash
# Todos los tests del dashboard
python run_tests.py dashboard

# Tests especÃ­ficos
pytest tests/test_dashboard_integration.py -v

# Con coverage
python run_tests.py dashboard --cov --html
```

### Tests Disponibles

El archivo `test_dashboard_integration.py` incluye **30+ tests** que verifican:

âœ… Endpoints bÃ¡sicos
âœ… Historial de trades
âœ… EstadÃ­sticas
âœ… Exports (CSV, Excel, Reportes)
âœ… Sesiones
âœ… Backtesting
âœ… SeÃ±ales
âœ… Health checks
âœ… Error handling
âœ… Performance

Ver [tests/README.md](tests/README.md) para mÃ¡s detalles.

---

## ğŸ”§ Troubleshooting

### Problema: Dashboard no carga

```bash
# Verificar que Flask estÃ¡ instalado
pip install flask flask-cors

# Verificar puerto 5000 no estÃ¡ en uso
netstat -ano | findstr :5000  # Windows
lsof -i :5000                 # Mac/Linux

# Usar otro puerto
python dashboard/app.py --port 8080
```

### Problema: No se ven trades

```bash
# Verificar que PostgreSQL estÃ¡ corriendo
docker ps | grep postgres

# Verificar tablas
python -c "from database.connection import DatabaseConnection; db = DatabaseConnection(); print('âœ… Connected')"

# Verificar que hay trades en BD
docker exec -it trading_bot_postgres psql -U trader -d trading_bot -c "SELECT COUNT(*) FROM trades;"
```

### Problema: Exports fallan

```bash
# Crear carpeta exports
mkdir exports

# Verificar permisos
chmod 755 exports

# Verificar openpyxl instalado
pip install openpyxl
```

### Problema: API no responde

```bash
# Verificar credenciales en .env
cat .env | grep CAPITAL

# Test de conexiÃ³n
python -c "from api.capital_client import CapitalClient; api = CapitalClient(); print('Auth:', api.authenticate())"
```

### Problema: Tests fallan

```bash
# Verificar pytest instalado
pip install pytest pytest-flask pytest-cov

# Ejecutar setup
python setup_dashboard.py

# Ejecutar un test individual
pytest tests/test_dashboard_integration.py::test_api_config -v
```

---

## ğŸ“š Estructura de Archivos

```
trading_bot/
â”œâ”€â”€ dashboard/
â”‚   â”œâ”€â”€ app.py                 # â† API Flask completa
â”‚   â”œâ”€â”€ templates/
â”‚   â”‚   â””â”€â”€ index.html         # â† Frontend
â”‚   â””â”€â”€ static/
â”‚       â”œâ”€â”€ css/
â”‚       â”‚   â””â”€â”€ style.css      # â† Estilos
â”‚       â””â”€â”€ js/
â”‚           â””â”€â”€ main.js        # â† JavaScript
â”œâ”€â”€ database/
â”‚   â””â”€â”€ queries/
â”‚       â””â”€â”€ analytics.py       # â† Queries SQL
â”œâ”€â”€ tests/
â”‚   â”œâ”€â”€ test_dashboard_integration.py  # â† Tests
â”‚   â”œâ”€â”€ conftest.py            # â† Fixtures
â”‚   â””â”€â”€ README.md              # â† GuÃ­a de tests
â”œâ”€â”€ exports/                   # â† Archivos exportados
â”œâ”€â”€ setup_dashboard.py         # â† Script de setup
â”œâ”€â”€ run_tests.py               # â† Ejecutar tests
â”œâ”€â”€ pytest.ini                 # â† Config pytest
â””â”€â”€ requirements.txt           # â† Dependencias
```

---

## ğŸ¨ PersonalizaciÃ³n

### Cambiar Puerto

```python
# dashboard/app.py
if __name__ == '__main__':
    run_dashboard(port=8080)  # Cambiar aquÃ­
```

### Cambiar Intervalo de Refresh

```javascript
// dashboard/static/js/main.js
const REFRESH_INTERVAL = 5000;  // 5 segundos
```

### Agregar Nuevo Endpoint

```python
# dashboard/app.py
@app.route('/api/mi_endpoint')
def mi_endpoint():
    # Tu cÃ³digo
    return jsonify({'data': ...})
```

Luego agregar test:
```python
# tests/test_dashboard_integration.py
def test_mi_endpoint(client):
    response = client.get('/api/mi_endpoint')
    assert response.status_code == 200
```

---

## ğŸš€ PrÃ³ximos Pasos

Una vez que el dashboard estÃ© funcionando:

1. **Ejecutar el bot**
   ```bash
   python start_all.py
   ```

2. **Dejar correr algunas horas** para generar datos

3. **Explorar el dashboard** en http://localhost:5000

4. **Exportar reportes** para anÃ¡lisis

5. **Ejecutar backtests** para probar estrategias

6. **Revisar mÃ©tricas** y optimizar la estrategia

---

## ğŸ“ Soporte

- **Tests:** `python run_tests.py dashboard`
- **Setup:** `python setup_dashboard.py`
- **Logs:** Revisar `logs/` y consola

---

**Â¡El dashboard estÃ¡ listo! ğŸ‰**

Ejecuta `python start_all.py` y abre http://localhost:5000